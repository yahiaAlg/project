<!-- loans/index.php (Admin view of all loans) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Loans - Library Management System</title>
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/book.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons">menu_book</i>
                Library Management
            </a>
            <nav>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                    <li class="nav-item"><a href="/books" class="nav-link">Books</a></li>
                    <li class="nav-item"><a href="/members" class="nav-link">Members</a></li>
                    <li class="nav-item"><a href="/loans" class="nav-link active">Loans</a></li>
                    <li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <?php $this->partial('_header'); ?>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">All Loans</h2>
                <a href="/loans/create" class="btn btn-primary">
                    <i class="material-icons mr-1">add</i> New Loan
                </a>
            </div>
            <div class="card-body">
                <div class="filter-bar mb-4">
                    <form action="/loans" method="GET" class="d-flex">
                        <div class="form-group mr-3">
                            <label for="status" class="mr-2">Status:</label>
                            <select name="status" id="status" class="form-select" onchange="this.form.submit()">
                                <option value="all" <?= $status == 'all' ? 'selected' : '' ?>>All Loans</option>
                                <option value="active" <?= $status == 'active' ? 'selected' : '' ?>>Active Loans</option>
                                <option value="overdue" <?= $status == 'overdue' ? 'selected' : '' ?>>Overdue Loans</option>
                                <option value="returned" <?= $status == 'returned' ? 'selected' : '' ?>>Returned Books</option>
                            </select>
                        </div>
                    </form>
                </div>

                <?php if (count($loans) > 0): ?>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Book</th>
                                    <th>Member</th>
                                    <th>Issue Date</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($loans as $loan): ?>
                                    <tr>
                                        <td><?= e($loan['book_title']) ?></td>
                                        <td><?= e($loan['member_name']) ?></td>
                                        <td><?= format_date($loan['issue_date']) ?></td>
                                        <td><?= format_date($loan['due_date']) ?></td>
                                        <td>
                                            <?php if ($loan['returned_at']): ?>
                                                <span class="badge badge-success">Returned</span>
                                            <?php elseif (strtotime($loan['due_date']) < time()): ?>
                                                <span class="badge badge-danger">Overdue</span>
                                            <?php else: ?>
                                                <span class="badge available">Active</span>
                                            <?php endif; ?>
                                        </td>
                                        <td>
                                            <a href="/loans/<?= $loan['id'] ?>" class="btn btn-sm btn-primary">View</a>
                                            
                                            <?php if (!$loan['returned_at']): ?>
                                                <a href="/loans/<?= $loan['id'] ?>/return" class="btn btn-sm btn-success">Return</a>
                                                <a href="/loans/<?= $loan['id'] ?>/renew" class="btn btn-sm btn-outline-primary">Renew</a>
                                            <?php endif; ?>
                                            
                                            <a href="/loans/<?= $loan['id'] ?>/delete" class="btn btn-sm btn-danger">Delete</a>
                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <?php if ($pagination['total_pages'] > 1): ?>
                        <div class="d-flex justify-content-center mt-4">
                            <ul class="pagination">
                                <?php if ($pagination['current_page'] > 1): ?>
                                    <li><a href="/loans?page=<?= $pagination['current_page'] - 1 ?>&status=<?= $status ?>" class="page-link">Previous</a></li>
                                <?php endif; ?>
                                
                                <?php for ($i = 1; $i <= $pagination['total_pages']; $i++): ?>
                                    <li>
                                        <a href="/loans?page=<?= $i ?>&status=<?= $status ?>" 
                                           class="page-link <?= $i == $pagination['current_page'] ? 'current' : '' ?>">
                                            <?= $i ?>
                                        </a>
                                    </li>
                                <?php endfor; ?>
                                
                                <?php if ($pagination['current_page'] < $pagination['total_pages']): ?>
                                    <li><a href="/loans?page=<?= $pagination['current_page'] + 1 ?>&status=<?= $status ?>" class="page-link">Next</a></li>
                                <?php endif; ?>
                            </ul>
                        </div>
                    <?php endif; ?>
                    
                <?php else: ?>
                    <div class="alert alert-info">
                        No loans found. <?php if ($status != 'all'): ?>Try changing the filter.<?php endif; ?>
                    </div>
                <?php endif; ?>
            </div>
        </div>
        
        <?php $this->partial('_footer'); ?>
    </div>
</body>
</html>

<!-- loans/member_loans.php (Member view of their loans) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Loans - Library Management System</title>
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/book.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons">menu_book</i>
                Library Management
            </a>
            <nav>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                    <li class="nav-item"><a href="/books" class="nav-link">Books</a></li>
                    <li class="nav-item"><a href="/loans" class="nav-link active">My Loans</a></li>
                    <li class="nav-item"><a href="/profile" class="nav-link">My Profile</a></li>
                    <li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <?php $this->partial('_header'); ?>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">My Loans</h2>
            </div>
            <div class="card-body">
                <div class="filter-bar mb-4">
                    <form action="/loans" method="GET" class="d-flex">
                        <div class="form-group mr-3">
                            <label for="status" class="mr-2">Status:</label>
                            <select name="status" id="status" class="form-select" onchange="this.form.submit()">
                                <option value="all" <?= $status == 'all' ? 'selected' : '' ?>>All Loans</option>
                                <option value="active" <?= $status == 'active' ? 'selected' : '' ?>>Active Loans</option>
                                <option value="overdue" <?= $status == 'overdue' ? 'selected' : '' ?>>Overdue Loans</option>
                                <option value="returned" <?= $status == 'returned' ? 'selected' : '' ?>>Returned Books</option>
                            </select>
                        </div>
                    </form>
                </div>

                <?php if (count($loans) > 0): ?>
                    <div class="book-grid">
                        <?php foreach ($loans as $loan): ?>
                            <div class="card">
                                <div class="d-flex p-3">
                                    <img src="<?= !empty($loan['book_cover']) ? e($loan['book_cover']) : '/assets/images/default-book.jpg' ?>" 
                                         alt="<?= e($loan['book_title']) ?>" class="rounded mr-3" style="width: 80px; height: 120px; object-fit: cover;">
                                    
                                    <div class="flex-grow-1">
                                        <h4 class="mb-1"><?= e($loan['book_title']) ?></h4>
                                        <p class="text-muted mb-2"><?= e($loan['book_author']) ?></p>
                                        
                                        <div class="book-meta-item">
                                            <span class="book-meta-label">Borrowed:</span>
                                            <span><?= format_date($loan['issue_date']) ?></span>
                                        </div>
                                        
                                        <div class="book-meta-item">
                                            <span class="book-meta-label">Due Date:</span>
                                            <span><?= format_date($loan['due_date']) ?></span>
                                        </div>
                                        
                                        <div class="book-meta-item">
                                            <span class="book-meta-label">Status:</span>
                                            <span>
                                                <?php if ($loan['returned_at']): ?>
                                                    <span class="badge badge-success">Returned</span>
                                                <?php elseif (strtotime($loan['due_date']) < time()): ?>
                                                    <span class="badge badge-danger">Overdue</span>
                                                <?php else: ?>
                                                    <span class="badge available">Active</span>
                                                <?php endif; ?>
                                            </span>
                                        </div>
                                        
                                        <div class="mt-3">
                                            <a href="/loans/<?= $loan['id'] ?>" class="btn btn-sm btn-primary">Details</a>
                                            
                                            <?php if (!$loan['returned_at'] && strtotime($loan['due_date']) >= time()): ?>
                                                <a href="/loans/<?= $loan['id'] ?>/renew" class="btn btn-sm btn-outline-primary">Renew</a>
                                            <?php endif; ?>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                    
                    <!-- Pagination -->
                    <?php if ($pagination['total_pages'] > 1): ?>
                        <div class="d-flex justify-content-center mt-4">
                            <ul class="pagination">
                                <?php if ($pagination['current_page'] > 1): ?>
                                    <li><a href="/loans?page=<?= $pagination['current_page'] - 1 ?>&status=<?= $status ?>" class="page-link">Previous</a></li>
                                <?php endif; ?>
                                
                                <?php for ($i = 1; $i <= $pagination['total_pages']; $i++): ?>
                                    <li>
                                        <a href="/loans?page=<?= $i ?>&status=<?= $status ?>" 
                                           class="page-link <?= $i == $pagination['current_page'] ? 'current' : '' ?>">
                                            <?= $i ?>
                                        </a>
                                    </li>
                                <?php endfor; ?>
                                
                                <?php if ($pagination['current_page'] < $pagination['total_pages']): ?>
                                    <li><a href="/loans?page=<?= $pagination['current_page'] + 1 ?>&status=<?= $status ?>" class="page-link">Next</a></li>
                                <?php endif; ?>
                            </ul>
                        </div>
                    <?php endif; ?>
                    
                <?php else: ?>
                    <div class="alert alert-info">
                        No loans found. <?php if ($status != 'all'): ?>Try changing the filter.<?php endif; ?>
                    </div>
                <?php endif; ?>
            </div>
        </div>
        
        <?php $this->partial('_footer'); ?>
    </div>
</body>
</html>

<!-- loans/show.php (View a specific loan) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Details - Library Management System</title>
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/book.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons">menu_book</i>
                Library Management
            </a>
            <nav>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                    <li class="nav-item"><a href="/books" class="nav-link">Books</a></li>
                    <?php if (is_admin()): ?>
                        <li class="nav-item"><a href="/members" class="nav-link">Members</a></li>
                    <?php endif; ?>
                    <li class="nav-item"><a href="/loans" class="nav-link active">Loans</a></li>
                    <li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <?php $this->partial('_header'); ?>

        <div class="book-detail">
            <img src="<?= !empty($loan['book_cover']) ? e($loan['book_cover']) : '/assets/images/default-book.jpg' ?>" 
                 alt="<?= e($loan['book_title']) ?>" class="book-cover">
            
            <div class="book-info">
                <h2><?= e($loan['book_title']) ?></h2>
                <p class="text-secondary mb-2"><?= e($loan['book_author']) ?></p>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="card-title">Loan Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="book-meta">
                            <div class="book-meta-item">
                                <span class="book-meta-label">Loan ID:</span>
                                <span><?= e($loan['id']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Status:</span>
                                <span>
                                    <?php if ($loan['returned_at']): ?>
                                        <span class="badge badge-success">Returned on <?= format_date($loan['returned_at']) ?></span>
                                    <?php elseif (strtotime($loan['due_date']) < time()): ?>
                                        <span class="badge badge-danger">Overdue by <?= days_difference($loan['due_date'], date('Y-m-d')) ?> days</span>
                                    <?php else: ?>
                                        <span class="badge available">Active</span>
                                    <?php endif; ?>
                                </span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Borrowed by:</span>
                                <span><?= e($loan['member_name']) ?> (<?= e($loan['member_email']) ?>)</span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Issue Date:</span>
                                <span><?= format_date($loan['issue_date']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Due Date:</span>
                                <span><?= format_date($loan['due_date']) ?></span>
                            </div>
                            
                            <?php if (!$loan['returned_at'] && $fine > 0): ?>
                                <div class="book-meta-item">
                                    <span class="book-meta-label">Current Fine:</span>
                                    <span class="text-danger">$<?= number_format($fine, 2) ?></span>
                                </div>
                            <?php endif; ?>
                            
                            <?php if ($loan['returned_at'] && $loan['fine_amount'] > 0): ?>
                                <div class="book-meta-item">
                                    <span class="book-meta-label">Fine Paid:</span>
                                    <span>$<?= number_format($loan['fine_amount'], 2) ?></span>
                                </div>
                            <?php endif; ?>
                            
                            <?php if (!empty($loan['notes'])): ?>
                                <div class="book-meta-item">
                                    <span class="book-meta-label">Notes:</span>
                                    <span><?= nl2br(e($loan['notes'])) ?></span>
                                </div>
                            <?php endif; ?>
                        </div>
                        
                        <div class="book-actions mt-4">
                            <a href="/loans" class="btn btn-outline-primary">Back to Loans</a>
                            
                            <?php if (!$loan['returned_at']): ?>
                                <?php if (is_admin()): ?>
                                    <a href="/loans/<?= $loan['id'] ?>/return" class="btn btn-success">Return Book</a>
                                <?php endif; ?>
                                
                                <a href="/loans/<?= $loan['id'] ?>/renew" class="btn btn-primary">Renew Loan</a>
                            <?php endif; ?>
                            
                            <?php if (is_admin()): ?>
                                <a href="/loans/<?= $loan['id'] ?>/delete" class="btn btn-danger">Delete</a>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <?php $this->partial('_footer'); ?>
    </div>
</body>
</html>

<!-- loans/create.php (Create a new loan) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Loan - Library Management System</title>
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/book.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons">menu_book</i>
                Library Management
            </a>
            <nav>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                    <li class="nav-item"><a href="/books" class="nav-link">Books</a></li>
                    <li class="nav-item"><a href="/members" class="nav-link">Members</a></li>
                    <li class="nav-item"><a href="/loans" class="nav-link active">Loans</a></li>
                    <li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <?php $this->partial('_header'); ?>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Create New Loan</h2>
            </div>
            <div class="card-body">
                <?php if (isset($errors) && count($errors) > 0): ?>
                    <div class="alert alert-danger">
                        <ul class="mb-0">
                            <?php foreach ($errors as $error): ?>
                                <li><?= e($error) ?></li>
                            <?php endforeach; ?>
                        </ul>
                    </div>
                <?php endif; ?>
                
                <form action="/loans/store" method="POST">
                    <div class="form-group">
                        <label for="book_id" class="form-label">Book:</label>
                        <select name="book_id" id="book_id" class="form-select" required>
                            <option value="">Select a book</option>
                            <?php foreach ($books as $book): ?>
                                <option value="<?= $book['id'] ?>" <?= isset($loan['book_id']) && $loan['book_id'] == $book['id'] ? 'selected' : '' ?>>
                                    <?= e($book['title']) ?> by <?= e($book['author']) ?> (<?= $book['available_copies'] ?> available)
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="member_id" class="form-label">Member:</label>
                        <select name="member_id" id="member_id" class="form-select" required>
                            <option value="">Select a member</option>
                            <?php foreach ($members as $member): ?>
                                <option value="<?= $member['id'] ?>" <?= isset($loan['member_id']) && $loan['member_id'] == $member['id'] ? 'selected' : '' ?>>
                                    <?= e($member['name']) ?> (<?= e($member['email']) ?>)
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="due_date" class="form-label">Due Date:</label>
                        <input type="date" name="due_date" id="due_date" class="form-control" 
                               value="<?= isset($loan['due_date']) ? $loan['due_date'] : $default_due_date ?>" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes" class="form-label">Notes:</label>
                        <textarea name="notes" id="notes" class="form-control" rows="3"><?= isset($loan['notes']) ? e($loan['notes']) : '' ?></textarea>
                    </div>
                    
                    <div class="form-group mt-4">
                        <a href="/loans" class="btn btn-outline-primary">Cancel</a>
                        <button type="submit" class="btn btn-primary">Create Loan</button>
                    </div>
                </form>
            </div>
        </div>
        
        <?php $this->partial('_footer'); ?>
    </div>
</body>
</html>

<!-- loans/return.php (Process book return) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return Book - Library Management System</title>
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/book.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons">menu_book</i>
                Library Management
            </a>
            <nav>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                    <li class="nav-item"><a href="/books" class="nav-link">Books</a></li>
                    <li class="nav-item"><a href="/members" class="nav-link">Members</a></li>
                    <li class="nav-item"><a href="/loans" class="nav-link active">Loans</a></li>
                    <li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <?php $this->partial('_header'); ?>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Return Book</h2>
            </div>
            <div class="card-body">
                <div class="book-detail mb-4">
                    <img src="<?= !empty($loan['book_cover']) ? e($loan['book_cover']) : '/assets/images/default-book.jpg' ?>" 
                         alt="<?= e($loan['book_title']) ?>" class="book-cover" style="max-width: 150px;">
                    
                    <div class="book-info">
                        <h3><?= e($loan['book_title']) ?></h3>
                        <p class="text-secondary mb-2"><?= e($loan['book_author']) ?></p>
                        
                        <div class="book-meta">
                            <div class="book-meta-item">
                                <span class="book-meta-label">Borrowed by:</span>
                                <span><?= e($loan['member_name']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Issue Date:</span>
                                <span><?= format_date($loan['issue_date']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Due Date:</span>
                                <span><?= format_date($loan['due_date']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Status:</span>
                                <span>
                                    <?php if (strtotime($loan['due_date']) < time()): ?>
                                        <span class="badge badge-danger">Overdue by <?= days_difference($loan['due_date'], date('Y-m-d')) ?> days</span>
                                    <?php else: ?>
                                        <span class="badge available">Active</span>
                                    <?php endif; ?>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form action="/loans/<?= $loan['id'] ?>/return" method="POST">
                    <?php if ($fine > 0): ?>
                        <div class="alert alert-warning">
                            <strong>This book is overdue!</strong> There is a fine of $<?= number_format($fine, 2) ?>.
                        </div>
                        
                        <div class="form-group">
                            <label for="fine_amount" class="form-label">Fine Amount:</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" step="0.01" min="0" name="fine_amount" id="fine_amount" class="form-control" 
                                       value="<?= number_format($fine, 2) ?>" required>
                            </div>
                            <div class="form-text">You can adjust the fine amount if needed.</div>
                        </div>
                    <?php else: ?>
                        <input type="hidden" name="fine_amount" value="0">
                    <?php endif; ?>
                    
                    <div class="form-group">
                        <label for="notes" class="form-label">Notes:</label>
                        <textarea name="notes" id="notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group mt-4">
                        <a href="/loans/<?= $loan['id'] ?>" class="btn btn-outline-primary">Cancel</a>
                        <button type="submit" class="btn btn-success">Confirm Return</button>
                    </div>
                </form>
            </div>
        </div>
        
        <?php $this->partial('_footer'); ?>
    </div>
</body>
</html>

<!-- loans/delete.php (Confirm loan deletion) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Loan - Library Management System</title>
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/book.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons">menu_book</i>
                Library Management
            </a>
            <nav>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                    <li class="nav-item"><a href="/books" class="nav-link">Books</a></li>
                    <li class="nav-item"><a href="/members" class="nav-link">Members</a></li>
                    <li class="nav-item"><a href="/loans" class="nav-link active">Loans</a></li>
                    <li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <?php $this->partial('_header'); ?>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Delete Loan</h2>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <h4 class="alert-heading">Warning!</h4>
                    <p>You are about to delete a loan record. This action cannot be undone.</p>
                    <p>If the book is still on loan, deleting this record will also increase the book's available copies.</p>
                </div>
                
                <div class="book-detail mb-4">
                    <img src="<?= !empty($loan['book_cover']) ? e($loan['book_cover']) : '/assets/images/default-book.jpg' ?>" 
                         alt="<?= e($loan['book_title']) ?>" class="book-cover" style="max-width: 150px;">
                    
                    <div class="book-info">
                        <h3><?= e($loan['book_title']) ?></h3>
                        <p class="text-secondary mb-2"><?= e($loan['book_author']) ?></p>
                        
                        <div class="book-meta">
                            <div class="book-meta-item">
                                <span class="book-meta-label">Loan ID:</span>
                                <span><?= e($loan['id']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Borrowed by:</span>
                                <span><?= e($loan['member_name']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Issue Date:</span>
                                <span><?= format_date($loan['issue_date']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Due Date:</span>
                                <span><?= format_date($loan['due_date']) ?></span>
                            </div>
                            
                            <div class="book-meta-item">
                                <span class="book-meta-label">Status:</span>
                                <span>
                                    <?php if ($loan['returned_at']): ?>
                                        <span class="badge badge-success">Returned on <?= format_date($loan['returned_at']) ?></span>
                                    <?php elseif (strtotime($loan['due_date']) < time()): ?>
                                        <span class="badge badge-danger">Overdue</span>
                                    <?php else: ?>
                                        <span class="badge available">Active</span>
                                    <?php endif; ?>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form action="/loans/<?= $loan['id'] ?>/destroy" method="POST">
                    <div class="form-group mt-4">
                        <a href="/loans/<?= $loan['id'] ?>" class="btn btn-outline-primary">Cancel</a>
                        <button type="submit" class="btn btn-danger">Confirm Delete</button>
                    </div>
                </form>
            </div>
        </div>
        
        <?php $this->partial('_footer'); ?>
    </div>
</body>
</html>

<!-- loans/history.php (View loan history) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan History - Library Management System</title>
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/book.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <div class="container navbar-container">
            <a href="/" class="navbar-brand">
                <i class="material-icons">menu_book</i>
                Library Management
            </a>
            <nav>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="/dashboard" class="nav-link">Dashboard</a></li>
                    <li class="nav-item"><a href="/books" class="nav-link">Books</a></li>
                    <li class="nav-item"><a href="/loans" class="nav-link">My Loans</a></li>
                    <li class="nav-item"><a href="/loans/history" class="nav-link active">Loan History</a></li>
                    <li class="nav-item"><a href="/profile" class="nav-link">My Profile</a></li>
                    <li class="nav-item"><a href="/logout" class="nav-link">Logout</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="main-content">
        <?php $this->partial('_header'); ?>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">My Reading History</h2>
            </div>
            <div class="card-body">
                <?php if (count($loans) > 0): ?>
                    <div class="book-grid">
                        <?php foreach ($loans as $loan): ?>
                            <div class="card">
                                <div class="d-flex p-3">
                                    <img src="<?= !empty($loan['book_cover']) ? e($loan['book_cover']) : '/assets/images/default-book.jpg' ?>" 
                                         alt="<?= e($loan['book_title']) ?>" class="rounded mr-3" style="width: 80px; height: 120px; object-fit: cover;">
                                    
                                    <div class="flex-grow-1">
                                        <h4 class="mb-1"><?= e($loan['book_title']) ?></h4>
                                        <p class="text-muted mb-2"><?= e($loan['book_author']) ?></p>
                                        
                                        <div class="book-meta-item">
                                            <span class="book-meta-label">Borrowed:</span>
                                            <span><?= format_date($loan['issue_date']) ?></span>
                                        </div>
                                        
                                        <div class="book-meta-item">
                                            <span class="book-meta-label">Returned:</span>
                                            <span><?= format_date($loan['returned_at']) ?></span>
                                        </div>
                                        
                                        <div class="mt-3">
                                            <a href="/loans/<?= $loan['id'] ?>" class="btn btn-sm btn-primary">Details</a>
                                            <a href="/books/<?= $loan['book_id'] ?>" class="btn btn-sm btn-outline-primary">View Book</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <?php endforeach; ?>
                    </div>
                    
                    <!-- Pagination -->
                    <?php if ($pagination['total_pages'] > 1): ?>
                        <div class="d-flex justify-content-center mt-4">
                            <ul class="pagination">
                                <?php if ($pagination['current_page'] > 1): ?>
                                    <li><a href="/loans/history?page=<?= $pagination['current_page'] - 1 ?>" class="page-link">Previous</a></li>
                                <?php endif; ?>
                                
                                <?php for ($i = 1; $i <= $pagination['total_pages']; $i++): ?>
                                    <li>
                                        <a href="/loans/history?page=<?= $i ?>" 
                                           class="page-link <?= $i == $pagination['current_page'] ? 'current' : '' ?>">
                                            <?= $i ?>
                                        </a>
                                    </li>
                                <?php endfor; ?>
                                
                                <?php if ($pagination['current_page'] < $pagination['total_pages']): ?>
                                    <li><a href="/loans/history?page=<?= $pagination['current_page'] + 1 ?>" class="page-link">Next</a></li>
                                <?php endif; ?>
                            </ul>
                        </div>
                    <?php endif; ?>
                    
                <?php else: ?>
                    <div class="alert alert-info">
                        <p>You haven't borrowed any books yet.</p>
                    </div>
                <?php endif; ?>
            </div>
        </div>
        
        <?php $this->partial('_footer'); ?>
    </div>
</body>
</html>